---
title: "Finding Firms with Largest Delta in Net COVID Sentiment"
output: html_notebook
---



```{r}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(lubridate)
library(corrr)
library(haven)
```




Read in data file  

```{r}

firms <- read_dta('../data/firmquarter_2022q1.dta')
firms 

```


Find entries whose COVID Net Sentiment isn't 0

```{r}
NonZero_Firms <- firms |> 
      filter(`Covid_Net_Sentiment` != 0) |> 
      filter(hqcountrycode == 'US') |> 
      mutate(date_earningscall = dmy(date_earningscall)) 
      
NonZero_Firms 
```


Find firms (and their earnings calls) the largest Deltas in their Net COVID Sentiments over time.

```{r}

Min_Max_Net_COVID_Sentiments <- NonZero_Firms |> 
                                    group_by(company_name) |> 
                                    mutate(Min_Net_COVID_Sentiment = min(Covid_Net_Sentiment)) |> 
                                    mutate(Max_Net_COVID_Sentiment = max(Covid_Net_Sentiment)) |> 
                                    mutate(Delta_Net_COVID_Sentiment = Max_Net_COVID_Sentiment - Min_Net_COVID_Sentiment) |> 
                                    arrange(desc(Delta_Net_COVID_Sentiment))
                                  #  arrange(desc(ticker)) |> 
                                #    arrange(date_earningscall) 
  
Min_Max_Net_COVID_Sentiments  

```





Find top firms with the largest Deltas in their Net COVID Sentiments over time.


```{r}

# Top_Firms <- Min_Max_Net_COVID_Sentiments  |> 
#                   distinct(company_name)  
# Top_Firms

# write_csv(Top_Firms, '../data/Top_Firms.csv')


```
```{r}

# Dates_Min_Max_Net_COVID_Sentiments <- Min_Max_Net_COVID_Sentiments |> 
#           group_by(company_name) |> 
#           filter(Covid_Net_Sentiment == Min_Net_COVID_Sentiment | Covid_Net_Sentiment == Max_Net_COVID_Sentiment) |> 
#           arrange(desc(Delta_Net_COVID_Sentiment))
# 
# Dates_Min_Max_Net_COVID_Sentiments


# write_csv(Dates_Min_Max_Net_COVID_Sentiments, '../data/Dates_Min_Max_Net_COVID_Sentiments.csv')

```


Find unique ticker symbols:

```{r}
# Tickers <- Dates_Min_Max_Net_COVID_Sentiments |> 
#   group_by(company_name) |> 
#   distinct(ticker)
```


```{r}
# US_Tickers <- read_csv('../data/DescendingUSTickers_Extended.csv') 
# 
# US_Tickers <- US_Tickers |> 
#                   distinct(ticker)

# write_csv(US_Tickers, '../data/US_Tickers.csv')

```



Insert industry info via join:

```{r}

Industries <- read_csv('../data/CompanyName_Ticker_Industry.csv')
Industries

```
```{r}

Industries <- Industries |> 
                select(-ticker)
Industries

```

```{r}

Net_COVID_Sentiments_Industries <- Min_Max_Net_COVID_Sentiments |> 
    inner_join(Industries, by=join_by(company_name))

Net_COVID_Sentiments_Industries

```

Exporting data for fetching of share price data:
Arranging tickers by descending order in order to place the entries without tickers at the end

```{r}

# SharePrice_Write_CSV_Prep <- Net_COVID_Sentiments_Industries |> 
#   arrange(desc(ticker))
# 
# write_csv(SharePrice_Write_CSV_Prep, "../data/DescendingTickers.csv")

```

Examines Net COVID Sentiment across industries over time: 

Side note: Advertising Agencies is the reference Industry 

```{r}

lm(log(Covid_Net_Sentiment) ~ c(Industry) + date_earningscall + Covid_Exposure, data = Net_COVID_Sentiments_Industries) |> 
    summary()

```





Examines Positive COVID Sentiment across industries over time:

```{r}

lm(Covid_Pos_Sentiment ~ c(Industry) + date_earningscall + Covid_Exposure, data = Net_COVID_Sentiments_Industries) |> 
    summary()

```



Examines Negative COVID Sentiment across industries over time:

```{r}

lm(Covid_Neg_Sentiment ~ c(Industry) + date_earningscall + Covid_Exposure + PRiskT_health, data = Net_COVID_Sentiments_Industries) |> 
    summary()

```
